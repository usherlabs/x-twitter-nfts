# (`zkaf`) ZK Verifier (Aurora / EVM) Contracts

EVM Contracts are generated by the `zkaf` RiscZero utility. Solidity has native support in RiscZero and is battle-tested across various projects building with zkVMs.
Aurora is an EVM L2 for the Near Blockchain. Therefore, to leverage this support, an Aurora Verification mechanism coupled with Near <> Aurora communication allows the X NFTs project to cross-reference NFT metadata dervied from a Tweet with a verified zkProof of X (Twitter) data.

The components within this project are:

- `apps` : This folder contains utilities for generating zkProofs from the CLI, as well as copying the generated ELF binary that represents the zkVM guest logic to the orchestrator (Near Indexer)
- `contracts` : This folder contains the generated Solidity contracts which are responsible for on-chain EVM verification.
- `methods` : This folder contains the ZK logic.

## Testing the contract

```jsx
// to build and test the generated solidity assets
cargo build
cargo test

forge build
forge test
```

## Verifying the build

After building the project, the image ID must be verified to ensure that the same proof is generated across multiple systems for this repository.

The file `contracts/ImageID.sol` should match the following identifier following a succesfull build.

```solidity
library ImageID {
    bytes32 public constant VERIFY_ID = bytes32(0xa68e16e0815455b36f043963fab7bc701e57e81876d0181e7a02d5d0faac1b23);
}
```

## Deploying the contract

```jsx
export ETH_WALLET_PRIVATE_KEY=""
forge script script/Deploy.s.sol --rpc-url https://aurora-testnet.drpc.org --broadcast --legacy
```

## ZK Proof

In order to generate and verify a proof:

The following environment variables need to be filled, copied and pasted into the terminal in which the proof generation command would work.:

```jsx
# EVM parameters
export EVM_CHAIN_ID=1313161555
export AURORA_RPC_URL="https://testnet.aurora.dev"
export EVM_VERIFIER_CONTRACT=0xa4015D18436d266074eC43bb9D2f8DfBAb2a45D5

# NEAR parameters
export NEAR_RPC_URL="https://rpc.testnet.near.org"
export NEAR_SIGNER_ACCOUNT_ID="local-verifier.testnet"
export NEAR_ACCOUNT_SECRET_KEY=""
export NEAR_VERIFIER_CONTRACT_ACCOUNT_ID="local-verifier.testnet"
export NFT_CONTRACT_ID="x-bitte-nft.testnet"

# BONSAI parameters
export BONSAI_API_KEY="" # provided with your api key
export BONSAI_API_URL="https://api.bonsai.xyz/"

# FORGE parameters
export ETH_WALLET_PRIVATE_KEY=
```

`env.sample`

Then proceed to run the following `cargo run --bin publisher` which would start by generating a proof using Bonsai, then verify the proof on aurora contract, it then uses the near contract to proxy a call to the aurora contract to confirm the validity of the recently generated proof which was verified on the aurora smart contract.

## RiscZero

To learn the basics of RiscZero, either refer to the [RiscZero Documentation](https://docs.risczero.com/getting-started/overview), or review the included [RiscZero Guide](./R0.md) in the `zkaf` folder.